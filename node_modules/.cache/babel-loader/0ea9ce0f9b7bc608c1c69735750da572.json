{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst utils_js_1 = require(\"../utils.js\");\nclass Session {\n  constructor(app, options) {\n    this.app = app;\n    this.options = options;\n    this.metadata = {};\n    this.userID = null;\n    this.callbacks = [];\n    this.timestamp = 0;\n    this.createTabId();\n  }\n  attachUpdateCallback(cb) {\n    this.callbacks.push(cb);\n  }\n  handleUpdate(newInfo) {\n    if (newInfo.userID == null) {\n      delete newInfo.userID;\n    }\n    if (newInfo.sessionID == null) {\n      delete newInfo.sessionID;\n    }\n    this.callbacks.forEach(cb => cb(newInfo));\n  }\n  assign(newInfo) {\n    if (newInfo.userID !== undefined) {\n      // TODO clear nullable/undefinable types\n      this.userID = newInfo.userID;\n    }\n    if (newInfo.metadata !== undefined) {\n      Object.entries(newInfo.metadata).forEach(([k, v]) => this.metadata[k] = v);\n    }\n    if (newInfo.sessionID !== undefined) {\n      this.sessionID = newInfo.sessionID;\n    }\n    if (newInfo.timestamp !== undefined) {\n      this.timestamp = newInfo.timestamp;\n    }\n    if (newInfo.projectID !== undefined) {\n      this.projectID = newInfo.projectID;\n    }\n    this.handleUpdate(newInfo);\n  }\n  setMetadata(key, value) {\n    this.metadata[key] = value;\n    this.handleUpdate({\n      metadata: {\n        [key]: value\n      }\n    });\n  }\n  setUserID(userID) {\n    this.userID = userID;\n    this.handleUpdate({\n      userID\n    });\n  }\n  setUserInfo(userInfo) {\n    this.userInfo = userInfo;\n  }\n  getPageNumber() {\n    const pageNoStr = this.app.sessionStorage.getItem(this.options.session_pageno_key);\n    if (pageNoStr == null) {\n      return undefined;\n    }\n    return parseInt(pageNoStr);\n  }\n  incPageNo() {\n    let pageNo = this.getPageNumber();\n    if (pageNo === undefined) {\n      pageNo = 0;\n    } else {\n      pageNo++;\n    }\n    this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNo.toString());\n    return pageNo;\n  }\n  getSessionToken() {\n    return this.app.sessionStorage.getItem(this.options.session_token_key) || undefined;\n  }\n  setSessionToken(token) {\n    this.app.sessionStorage.setItem(this.options.session_token_key, token);\n  }\n  applySessionHash(hash) {\n    const hashParts = decodeURI(hash).split('&');\n    let token = hash;\n    let pageNoStr = '100500'; // back-compat for sessionToken\n    if (hashParts.length == 2) {\n      ;\n      [pageNoStr, token] = hashParts;\n    }\n    if (!pageNoStr || !token) {\n      return;\n    }\n    this.app.sessionStorage.setItem(this.options.session_token_key, token);\n    this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNoStr);\n  }\n  getSessionHash() {\n    const pageNo = this.getPageNumber();\n    const token = this.getSessionToken();\n    if (pageNo === undefined || token === undefined) {\n      return;\n    }\n    return encodeURI(String(pageNo) + '&' + token);\n  }\n  getTabId() {\n    if (!this.tabId) this.createTabId();\n    return this.tabId;\n  }\n  regenerateTabId() {\n    const randomId = (0, utils_js_1.generateRandomId)(12);\n    this.app.sessionStorage.setItem(this.options.session_tabid_key, randomId);\n    this.tabId = randomId;\n  }\n  createTabId() {\n    const localId = this.app.sessionStorage.getItem(this.options.session_tabid_key);\n    if (localId) {\n      this.tabId = localId;\n    } else {\n      this.regenerateTabId();\n    }\n  }\n  getInfo() {\n    return {\n      sessionID: this.sessionID,\n      metadata: this.metadata,\n      userID: this.userID,\n      timestamp: this.timestamp,\n      projectID: this.projectID\n    };\n  }\n  reset() {\n    this.app.sessionStorage.removeItem(this.options.session_token_key);\n    this.metadata = {};\n    this.userID = null;\n    this.sessionID = undefined;\n    this.timestamp = 0;\n  }\n}\nexports.default = Session;","map":{"version":3,"names":["Object","defineProperty","exports","value","utils_js_1","require","Session","constructor","app","options","metadata","userID","callbacks","timestamp","createTabId","attachUpdateCallback","cb","push","handleUpdate","newInfo","sessionID","forEach","assign","undefined","entries","k","v","projectID","setMetadata","key","setUserID","setUserInfo","userInfo","getPageNumber","pageNoStr","sessionStorage","getItem","session_pageno_key","parseInt","incPageNo","pageNo","setItem","toString","getSessionToken","session_token_key","setSessionToken","token","applySessionHash","hash","hashParts","decodeURI","split","length","getSessionHash","encodeURI","String","getTabId","tabId","regenerateTabId","randomId","generateRandomId","session_tabid_key","localId","getInfo","reset","removeItem","default"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/app/session.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_js_1 = require(\"../utils.js\");\nclass Session {\n    constructor(app, options) {\n        this.app = app;\n        this.options = options;\n        this.metadata = {};\n        this.userID = null;\n        this.callbacks = [];\n        this.timestamp = 0;\n        this.createTabId();\n    }\n    attachUpdateCallback(cb) {\n        this.callbacks.push(cb);\n    }\n    handleUpdate(newInfo) {\n        if (newInfo.userID == null) {\n            delete newInfo.userID;\n        }\n        if (newInfo.sessionID == null) {\n            delete newInfo.sessionID;\n        }\n        this.callbacks.forEach((cb) => cb(newInfo));\n    }\n    assign(newInfo) {\n        if (newInfo.userID !== undefined) {\n            // TODO clear nullable/undefinable types\n            this.userID = newInfo.userID;\n        }\n        if (newInfo.metadata !== undefined) {\n            Object.entries(newInfo.metadata).forEach(([k, v]) => (this.metadata[k] = v));\n        }\n        if (newInfo.sessionID !== undefined) {\n            this.sessionID = newInfo.sessionID;\n        }\n        if (newInfo.timestamp !== undefined) {\n            this.timestamp = newInfo.timestamp;\n        }\n        if (newInfo.projectID !== undefined) {\n            this.projectID = newInfo.projectID;\n        }\n        this.handleUpdate(newInfo);\n    }\n    setMetadata(key, value) {\n        this.metadata[key] = value;\n        this.handleUpdate({ metadata: { [key]: value } });\n    }\n    setUserID(userID) {\n        this.userID = userID;\n        this.handleUpdate({ userID });\n    }\n    setUserInfo(userInfo) {\n        this.userInfo = userInfo;\n    }\n    getPageNumber() {\n        const pageNoStr = this.app.sessionStorage.getItem(this.options.session_pageno_key);\n        if (pageNoStr == null) {\n            return undefined;\n        }\n        return parseInt(pageNoStr);\n    }\n    incPageNo() {\n        let pageNo = this.getPageNumber();\n        if (pageNo === undefined) {\n            pageNo = 0;\n        }\n        else {\n            pageNo++;\n        }\n        this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNo.toString());\n        return pageNo;\n    }\n    getSessionToken() {\n        return this.app.sessionStorage.getItem(this.options.session_token_key) || undefined;\n    }\n    setSessionToken(token) {\n        this.app.sessionStorage.setItem(this.options.session_token_key, token);\n    }\n    applySessionHash(hash) {\n        const hashParts = decodeURI(hash).split('&');\n        let token = hash;\n        let pageNoStr = '100500'; // back-compat for sessionToken\n        if (hashParts.length == 2) {\n            ;\n            [pageNoStr, token] = hashParts;\n        }\n        if (!pageNoStr || !token) {\n            return;\n        }\n        this.app.sessionStorage.setItem(this.options.session_token_key, token);\n        this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNoStr);\n    }\n    getSessionHash() {\n        const pageNo = this.getPageNumber();\n        const token = this.getSessionToken();\n        if (pageNo === undefined || token === undefined) {\n            return;\n        }\n        return encodeURI(String(pageNo) + '&' + token);\n    }\n    getTabId() {\n        if (!this.tabId)\n            this.createTabId();\n        return this.tabId;\n    }\n    regenerateTabId() {\n        const randomId = (0, utils_js_1.generateRandomId)(12);\n        this.app.sessionStorage.setItem(this.options.session_tabid_key, randomId);\n        this.tabId = randomId;\n    }\n    createTabId() {\n        const localId = this.app.sessionStorage.getItem(this.options.session_tabid_key);\n        if (localId) {\n            this.tabId = localId;\n        }\n        else {\n            this.regenerateTabId();\n        }\n    }\n    getInfo() {\n        return {\n            sessionID: this.sessionID,\n            metadata: this.metadata,\n            userID: this.userID,\n            timestamp: this.timestamp,\n            projectID: this.projectID,\n        };\n    }\n    reset() {\n        this.app.sessionStorage.removeItem(this.options.session_token_key);\n        this.metadata = {};\n        this.userID = null;\n        this.sessionID = undefined;\n        this.timestamp = 0;\n    }\n}\nexports.default = Session;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}