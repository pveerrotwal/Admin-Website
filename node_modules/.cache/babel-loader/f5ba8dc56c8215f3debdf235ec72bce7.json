{"ast":null,"code":"import { AdoptedSSReplaceURLBased, AdoptedSSInsertRuleURLBased, AdoptedSSAddOwner, AdoptedSSRemoveOwner } from '../app/messages.gen.js';\nimport { isRootNode } from '../app/guards.js';\nfunction hasAdoptedSS(node) {\n  return isRootNode(node) &&\n  // @ts-ignore\n  !!node.adoptedStyleSheets;\n}\n// TODO: encapsulate to be init-ed on-start and join with cssrules.ts under one folder\nlet _id = 0xf;\nexport function nextID() {\n  return _id++;\n}\nexport const styleSheetIDMap = new Map();\nexport default function (app) {\n  if (app === null) {\n    return;\n  }\n  if (!hasAdoptedSS(document)) {\n    return;\n  }\n  const styleSheetIDMap = new Map();\n  const adoptedStyleSheetsOwnings = new Map();\n  const sendAdoptedStyleSheetsUpdate = root => setTimeout(() => {\n    let nodeID = app.nodes.getID(root);\n    if (root === document) {\n      nodeID = 0; // main document doesn't have nodeID. ID count starts from the documentElement\n    }\n    if (nodeID === undefined) {\n      return;\n    }\n    let pastOwning = adoptedStyleSheetsOwnings.get(nodeID);\n    if (!pastOwning) {\n      pastOwning = [];\n    }\n    const nowOwning = [];\n    const styleSheets = root.adoptedStyleSheets;\n    if (Symbol.iterator in styleSheets) {\n      for (const s of styleSheets) {\n        let sheetID = styleSheetIDMap.get(s);\n        const init = !sheetID;\n        if (!sheetID) {\n          sheetID = nextID();\n          styleSheetIDMap.set(s, sheetID);\n        }\n        if (!pastOwning.includes(sheetID)) {\n          app.send(AdoptedSSAddOwner(sheetID, nodeID));\n        }\n        if (init) {\n          const rules = s.cssRules;\n          for (let i = 0; i < rules.length; i++) {\n            app.send(AdoptedSSInsertRuleURLBased(sheetID, rules[i].cssText, i, app.getBaseHref()));\n          }\n        }\n        nowOwning.push(sheetID);\n      }\n    }\n    if (Symbol.iterator in pastOwning) {\n      for (const sheetID of pastOwning) {\n        if (!nowOwning.includes(sheetID)) {\n          app.send(AdoptedSSRemoveOwner(sheetID, nodeID));\n        }\n      }\n    }\n    adoptedStyleSheetsOwnings.set(nodeID, nowOwning);\n  }, 20); // Mysterious bug:\n  /* On the page https://explore.fast.design/components/fast-accordion\n    the only rule inside the only adoptedStyleSheet of the iframe-s document\n    gets changed during first milliseconds after the load.\n    However, none of the documented methods (replace, insertRule) is triggered.\n    The rule is not substituted (remains the same object), however the text gets changed.\n  */\n  function patchAdoptedStyleSheets(prototype) {\n    const nativeAdoptedStyleSheetsDescriptor = Object.getOwnPropertyDescriptor(prototype, 'adoptedStyleSheets');\n    if (nativeAdoptedStyleSheetsDescriptor) {\n      Object.defineProperty(prototype, 'adoptedStyleSheets', Object.assign(Object.assign({}, nativeAdoptedStyleSheetsDescriptor), {\n        set: function (value) {\n          // @ts-ignore\n          const retVal = nativeAdoptedStyleSheetsDescriptor.set.call(this, value);\n          sendAdoptedStyleSheetsUpdate(this);\n          return retVal;\n        }\n      }));\n    }\n  }\n  const patchContext = context => {\n    // @ts-ignore\n    if (context.__openreplay_adpss_patched__) {\n      return;\n    } else {\n      // @ts-ignore\n      context.__openreplay_adpss_patched__ = true;\n    }\n    patchAdoptedStyleSheets(context.Document.prototype);\n    patchAdoptedStyleSheets(context.ShadowRoot.prototype);\n    //@ts-ignore TODO: upgrade ts to 4.8+\n    const {\n      replace,\n      replaceSync\n    } = context.CSSStyleSheet.prototype;\n    //@ts-ignore\n    context.CSSStyleSheet.prototype.replace = function (text) {\n      return replace.call(this, text).then(sheet => {\n        const sheetID = styleSheetIDMap.get(this);\n        if (sheetID) {\n          app.send(AdoptedSSReplaceURLBased(sheetID, text, app.getBaseHref()));\n        }\n        return sheet;\n      });\n    };\n    //@ts-ignore\n    context.CSSStyleSheet.prototype.replaceSync = function (text) {\n      const sheetID = styleSheetIDMap.get(this);\n      if (sheetID) {\n        app.send(AdoptedSSReplaceURLBased(sheetID, text, app.getBaseHref()));\n      }\n      return replaceSync.call(this, text);\n    };\n  };\n  patchContext(window);\n  app.observer.attachContextCallback(app.safe(patchContext));\n  app.attachStopCallback(() => {\n    styleSheetIDMap.clear();\n    adoptedStyleSheetsOwnings.clear();\n  });\n  // So far main Document is not triggered with nodeCallbacks\n  app.attachStartCallback(() => {\n    sendAdoptedStyleSheetsUpdate(document);\n  });\n  app.nodes.attachNodeCallback(node => {\n    if (hasAdoptedSS(node)) {\n      sendAdoptedStyleSheetsUpdate(node);\n    }\n  });\n}","map":{"version":3,"names":["AdoptedSSReplaceURLBased","AdoptedSSInsertRuleURLBased","AdoptedSSAddOwner","AdoptedSSRemoveOwner","isRootNode","hasAdoptedSS","node","adoptedStyleSheets","_id","nextID","styleSheetIDMap","Map","app","document","adoptedStyleSheetsOwnings","sendAdoptedStyleSheetsUpdate","root","setTimeout","nodeID","nodes","getID","undefined","pastOwning","get","nowOwning","styleSheets","Symbol","iterator","s","sheetID","init","set","includes","send","rules","cssRules","i","length","cssText","getBaseHref","push","patchAdoptedStyleSheets","prototype","nativeAdoptedStyleSheetsDescriptor","Object","getOwnPropertyDescriptor","defineProperty","assign","value","retVal","call","patchContext","context","__openreplay_adpss_patched__","Document","ShadowRoot","replace","replaceSync","CSSStyleSheet","text","then","sheet","window","observer","attachContextCallback","safe","attachStopCallback","clear","attachStartCallback","attachNodeCallback"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/lib/modules/constructedStyleSheets.js"],"sourcesContent":["import { AdoptedSSReplaceURLBased, AdoptedSSInsertRuleURLBased, AdoptedSSAddOwner, AdoptedSSRemoveOwner, } from '../app/messages.gen.js';\nimport { isRootNode } from '../app/guards.js';\nfunction hasAdoptedSS(node) {\n    return (isRootNode(node) &&\n        // @ts-ignore\n        !!node.adoptedStyleSheets);\n}\n// TODO: encapsulate to be init-ed on-start and join with cssrules.ts under one folder\nlet _id = 0xf;\nexport function nextID() {\n    return _id++;\n}\nexport const styleSheetIDMap = new Map();\nexport default function (app) {\n    if (app === null) {\n        return;\n    }\n    if (!hasAdoptedSS(document)) {\n        return;\n    }\n    const styleSheetIDMap = new Map();\n    const adoptedStyleSheetsOwnings = new Map();\n    const sendAdoptedStyleSheetsUpdate = (root) => setTimeout(() => {\n        let nodeID = app.nodes.getID(root);\n        if (root === document) {\n            nodeID = 0; // main document doesn't have nodeID. ID count starts from the documentElement\n        }\n        if (nodeID === undefined) {\n            return;\n        }\n        let pastOwning = adoptedStyleSheetsOwnings.get(nodeID);\n        if (!pastOwning) {\n            pastOwning = [];\n        }\n        const nowOwning = [];\n        const styleSheets = root.adoptedStyleSheets;\n        if (Symbol.iterator in styleSheets) {\n            for (const s of styleSheets) {\n                let sheetID = styleSheetIDMap.get(s);\n                const init = !sheetID;\n                if (!sheetID) {\n                    sheetID = nextID();\n                    styleSheetIDMap.set(s, sheetID);\n                }\n                if (!pastOwning.includes(sheetID)) {\n                    app.send(AdoptedSSAddOwner(sheetID, nodeID));\n                }\n                if (init) {\n                    const rules = s.cssRules;\n                    for (let i = 0; i < rules.length; i++) {\n                        app.send(AdoptedSSInsertRuleURLBased(sheetID, rules[i].cssText, i, app.getBaseHref()));\n                    }\n                }\n                nowOwning.push(sheetID);\n            }\n        }\n        if (Symbol.iterator in pastOwning) {\n            for (const sheetID of pastOwning) {\n                if (!nowOwning.includes(sheetID)) {\n                    app.send(AdoptedSSRemoveOwner(sheetID, nodeID));\n                }\n            }\n        }\n        adoptedStyleSheetsOwnings.set(nodeID, nowOwning);\n    }, 20); // Mysterious bug:\n    /* On the page https://explore.fast.design/components/fast-accordion\n      the only rule inside the only adoptedStyleSheet of the iframe-s document\n      gets changed during first milliseconds after the load.\n      However, none of the documented methods (replace, insertRule) is triggered.\n      The rule is not substituted (remains the same object), however the text gets changed.\n    */\n    function patchAdoptedStyleSheets(prototype) {\n        const nativeAdoptedStyleSheetsDescriptor = Object.getOwnPropertyDescriptor(prototype, 'adoptedStyleSheets');\n        if (nativeAdoptedStyleSheetsDescriptor) {\n            Object.defineProperty(prototype, 'adoptedStyleSheets', Object.assign(Object.assign({}, nativeAdoptedStyleSheetsDescriptor), { set: function (value) {\n                    // @ts-ignore\n                    const retVal = nativeAdoptedStyleSheetsDescriptor.set.call(this, value);\n                    sendAdoptedStyleSheetsUpdate(this);\n                    return retVal;\n                } }));\n        }\n    }\n    const patchContext = (context) => {\n        // @ts-ignore\n        if (context.__openreplay_adpss_patched__) {\n            return;\n        }\n        else {\n            // @ts-ignore\n            context.__openreplay_adpss_patched__ = true;\n        }\n        patchAdoptedStyleSheets(context.Document.prototype);\n        patchAdoptedStyleSheets(context.ShadowRoot.prototype);\n        //@ts-ignore TODO: upgrade ts to 4.8+\n        const { replace, replaceSync } = context.CSSStyleSheet.prototype;\n        //@ts-ignore\n        context.CSSStyleSheet.prototype.replace = function (text) {\n            return replace.call(this, text).then((sheet) => {\n                const sheetID = styleSheetIDMap.get(this);\n                if (sheetID) {\n                    app.send(AdoptedSSReplaceURLBased(sheetID, text, app.getBaseHref()));\n                }\n                return sheet;\n            });\n        };\n        //@ts-ignore\n        context.CSSStyleSheet.prototype.replaceSync = function (text) {\n            const sheetID = styleSheetIDMap.get(this);\n            if (sheetID) {\n                app.send(AdoptedSSReplaceURLBased(sheetID, text, app.getBaseHref()));\n            }\n            return replaceSync.call(this, text);\n        };\n    };\n    patchContext(window);\n    app.observer.attachContextCallback(app.safe(patchContext));\n    app.attachStopCallback(() => {\n        styleSheetIDMap.clear();\n        adoptedStyleSheetsOwnings.clear();\n    });\n    // So far main Document is not triggered with nodeCallbacks\n    app.attachStartCallback(() => {\n        sendAdoptedStyleSheetsUpdate(document);\n    });\n    app.nodes.attachNodeCallback((node) => {\n        if (hasAdoptedSS(node)) {\n            sendAdoptedStyleSheetsUpdate(node);\n        }\n    });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}