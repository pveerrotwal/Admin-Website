{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.styleSheetIDMap = exports.nextID = void 0;\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nfunction hasAdoptedSS(node) {\n  return (0, guards_js_1.isRootNode)(node) &&\n  // @ts-ignore\n  !!node.adoptedStyleSheets;\n}\n// TODO: encapsulate to be init-ed on-start and join with cssrules.ts under one folder\nlet _id = 0xf;\nfunction nextID() {\n  return _id++;\n}\nexports.nextID = nextID;\nexports.styleSheetIDMap = new Map();\nfunction default_1(app) {\n  if (app === null) {\n    return;\n  }\n  if (!hasAdoptedSS(document)) {\n    return;\n  }\n  const styleSheetIDMap = new Map();\n  const adoptedStyleSheetsOwnings = new Map();\n  const sendAdoptedStyleSheetsUpdate = root => setTimeout(() => {\n    let nodeID = app.nodes.getID(root);\n    if (root === document) {\n      nodeID = 0; // main document doesn't have nodeID. ID count starts from the documentElement\n    }\n    if (nodeID === undefined) {\n      return;\n    }\n    let pastOwning = adoptedStyleSheetsOwnings.get(nodeID);\n    if (!pastOwning) {\n      pastOwning = [];\n    }\n    const nowOwning = [];\n    const styleSheets = root.adoptedStyleSheets;\n    if (Symbol.iterator in styleSheets) {\n      for (const s of styleSheets) {\n        let sheetID = styleSheetIDMap.get(s);\n        const init = !sheetID;\n        if (!sheetID) {\n          sheetID = nextID();\n          styleSheetIDMap.set(s, sheetID);\n        }\n        if (!pastOwning.includes(sheetID)) {\n          app.send((0, messages_gen_js_1.AdoptedSSAddOwner)(sheetID, nodeID));\n        }\n        if (init) {\n          const rules = s.cssRules;\n          for (let i = 0; i < rules.length; i++) {\n            app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, rules[i].cssText, i, app.getBaseHref()));\n          }\n        }\n        nowOwning.push(sheetID);\n      }\n    }\n    if (Symbol.iterator in pastOwning) {\n      for (const sheetID of pastOwning) {\n        if (!nowOwning.includes(sheetID)) {\n          app.send((0, messages_gen_js_1.AdoptedSSRemoveOwner)(sheetID, nodeID));\n        }\n      }\n    }\n    adoptedStyleSheetsOwnings.set(nodeID, nowOwning);\n  }, 20); // Mysterious bug:\n  /* On the page https://explore.fast.design/components/fast-accordion\n    the only rule inside the only adoptedStyleSheet of the iframe-s document\n    gets changed during first milliseconds after the load.\n    However, none of the documented methods (replace, insertRule) is triggered.\n    The rule is not substituted (remains the same object), however the text gets changed.\n  */\n  function patchAdoptedStyleSheets(prototype) {\n    const nativeAdoptedStyleSheetsDescriptor = Object.getOwnPropertyDescriptor(prototype, 'adoptedStyleSheets');\n    if (nativeAdoptedStyleSheetsDescriptor) {\n      Object.defineProperty(prototype, 'adoptedStyleSheets', Object.assign(Object.assign({}, nativeAdoptedStyleSheetsDescriptor), {\n        set: function (value) {\n          // @ts-ignore\n          const retVal = nativeAdoptedStyleSheetsDescriptor.set.call(this, value);\n          sendAdoptedStyleSheetsUpdate(this);\n          return retVal;\n        }\n      }));\n    }\n  }\n  const patchContext = context => {\n    // @ts-ignore\n    if (context.__openreplay_adpss_patched__) {\n      return;\n    } else {\n      // @ts-ignore\n      context.__openreplay_adpss_patched__ = true;\n    }\n    patchAdoptedStyleSheets(context.Document.prototype);\n    patchAdoptedStyleSheets(context.ShadowRoot.prototype);\n    //@ts-ignore TODO: upgrade ts to 4.8+\n    const {\n      replace,\n      replaceSync\n    } = context.CSSStyleSheet.prototype;\n    //@ts-ignore\n    context.CSSStyleSheet.prototype.replace = function (text) {\n      return replace.call(this, text).then(sheet => {\n        const sheetID = styleSheetIDMap.get(this);\n        if (sheetID) {\n          app.send((0, messages_gen_js_1.AdoptedSSReplaceURLBased)(sheetID, text, app.getBaseHref()));\n        }\n        return sheet;\n      });\n    };\n    //@ts-ignore\n    context.CSSStyleSheet.prototype.replaceSync = function (text) {\n      const sheetID = styleSheetIDMap.get(this);\n      if (sheetID) {\n        app.send((0, messages_gen_js_1.AdoptedSSReplaceURLBased)(sheetID, text, app.getBaseHref()));\n      }\n      return replaceSync.call(this, text);\n    };\n  };\n  patchContext(window);\n  app.observer.attachContextCallback(app.safe(patchContext));\n  app.attachStopCallback(() => {\n    styleSheetIDMap.clear();\n    adoptedStyleSheetsOwnings.clear();\n  });\n  // So far main Document is not triggered with nodeCallbacks\n  app.attachStartCallback(() => {\n    sendAdoptedStyleSheetsUpdate(document);\n  });\n  app.nodes.attachNodeCallback(node => {\n    if (hasAdoptedSS(node)) {\n      sendAdoptedStyleSheetsUpdate(node);\n    }\n  });\n}\nexports.default = default_1;","map":{"version":3,"names":["Object","defineProperty","exports","value","styleSheetIDMap","nextID","messages_gen_js_1","require","guards_js_1","hasAdoptedSS","node","isRootNode","adoptedStyleSheets","_id","Map","default_1","app","document","adoptedStyleSheetsOwnings","sendAdoptedStyleSheetsUpdate","root","setTimeout","nodeID","nodes","getID","undefined","pastOwning","get","nowOwning","styleSheets","Symbol","iterator","s","sheetID","init","set","includes","send","AdoptedSSAddOwner","rules","cssRules","i","length","AdoptedSSInsertRuleURLBased","cssText","getBaseHref","push","AdoptedSSRemoveOwner","patchAdoptedStyleSheets","prototype","nativeAdoptedStyleSheetsDescriptor","getOwnPropertyDescriptor","assign","retVal","call","patchContext","context","__openreplay_adpss_patched__","Document","ShadowRoot","replace","replaceSync","CSSStyleSheet","text","then","sheet","AdoptedSSReplaceURLBased","window","observer","attachContextCallback","safe","attachStopCallback","clear","attachStartCallback","attachNodeCallback","default"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/modules/constructedStyleSheets.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.styleSheetIDMap = exports.nextID = void 0;\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nfunction hasAdoptedSS(node) {\n    return ((0, guards_js_1.isRootNode)(node) &&\n        // @ts-ignore\n        !!node.adoptedStyleSheets);\n}\n// TODO: encapsulate to be init-ed on-start and join with cssrules.ts under one folder\nlet _id = 0xf;\nfunction nextID() {\n    return _id++;\n}\nexports.nextID = nextID;\nexports.styleSheetIDMap = new Map();\nfunction default_1(app) {\n    if (app === null) {\n        return;\n    }\n    if (!hasAdoptedSS(document)) {\n        return;\n    }\n    const styleSheetIDMap = new Map();\n    const adoptedStyleSheetsOwnings = new Map();\n    const sendAdoptedStyleSheetsUpdate = (root) => setTimeout(() => {\n        let nodeID = app.nodes.getID(root);\n        if (root === document) {\n            nodeID = 0; // main document doesn't have nodeID. ID count starts from the documentElement\n        }\n        if (nodeID === undefined) {\n            return;\n        }\n        let pastOwning = adoptedStyleSheetsOwnings.get(nodeID);\n        if (!pastOwning) {\n            pastOwning = [];\n        }\n        const nowOwning = [];\n        const styleSheets = root.adoptedStyleSheets;\n        if (Symbol.iterator in styleSheets) {\n            for (const s of styleSheets) {\n                let sheetID = styleSheetIDMap.get(s);\n                const init = !sheetID;\n                if (!sheetID) {\n                    sheetID = nextID();\n                    styleSheetIDMap.set(s, sheetID);\n                }\n                if (!pastOwning.includes(sheetID)) {\n                    app.send((0, messages_gen_js_1.AdoptedSSAddOwner)(sheetID, nodeID));\n                }\n                if (init) {\n                    const rules = s.cssRules;\n                    for (let i = 0; i < rules.length; i++) {\n                        app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, rules[i].cssText, i, app.getBaseHref()));\n                    }\n                }\n                nowOwning.push(sheetID);\n            }\n        }\n        if (Symbol.iterator in pastOwning) {\n            for (const sheetID of pastOwning) {\n                if (!nowOwning.includes(sheetID)) {\n                    app.send((0, messages_gen_js_1.AdoptedSSRemoveOwner)(sheetID, nodeID));\n                }\n            }\n        }\n        adoptedStyleSheetsOwnings.set(nodeID, nowOwning);\n    }, 20); // Mysterious bug:\n    /* On the page https://explore.fast.design/components/fast-accordion\n      the only rule inside the only adoptedStyleSheet of the iframe-s document\n      gets changed during first milliseconds after the load.\n      However, none of the documented methods (replace, insertRule) is triggered.\n      The rule is not substituted (remains the same object), however the text gets changed.\n    */\n    function patchAdoptedStyleSheets(prototype) {\n        const nativeAdoptedStyleSheetsDescriptor = Object.getOwnPropertyDescriptor(prototype, 'adoptedStyleSheets');\n        if (nativeAdoptedStyleSheetsDescriptor) {\n            Object.defineProperty(prototype, 'adoptedStyleSheets', Object.assign(Object.assign({}, nativeAdoptedStyleSheetsDescriptor), { set: function (value) {\n                    // @ts-ignore\n                    const retVal = nativeAdoptedStyleSheetsDescriptor.set.call(this, value);\n                    sendAdoptedStyleSheetsUpdate(this);\n                    return retVal;\n                } }));\n        }\n    }\n    const patchContext = (context) => {\n        // @ts-ignore\n        if (context.__openreplay_adpss_patched__) {\n            return;\n        }\n        else {\n            // @ts-ignore\n            context.__openreplay_adpss_patched__ = true;\n        }\n        patchAdoptedStyleSheets(context.Document.prototype);\n        patchAdoptedStyleSheets(context.ShadowRoot.prototype);\n        //@ts-ignore TODO: upgrade ts to 4.8+\n        const { replace, replaceSync } = context.CSSStyleSheet.prototype;\n        //@ts-ignore\n        context.CSSStyleSheet.prototype.replace = function (text) {\n            return replace.call(this, text).then((sheet) => {\n                const sheetID = styleSheetIDMap.get(this);\n                if (sheetID) {\n                    app.send((0, messages_gen_js_1.AdoptedSSReplaceURLBased)(sheetID, text, app.getBaseHref()));\n                }\n                return sheet;\n            });\n        };\n        //@ts-ignore\n        context.CSSStyleSheet.prototype.replaceSync = function (text) {\n            const sheetID = styleSheetIDMap.get(this);\n            if (sheetID) {\n                app.send((0, messages_gen_js_1.AdoptedSSReplaceURLBased)(sheetID, text, app.getBaseHref()));\n            }\n            return replaceSync.call(this, text);\n        };\n    };\n    patchContext(window);\n    app.observer.attachContextCallback(app.safe(patchContext));\n    app.attachStopCallback(() => {\n        styleSheetIDMap.clear();\n        adoptedStyleSheetsOwnings.clear();\n    });\n    // So far main Document is not triggered with nodeCallbacks\n    app.attachStartCallback(() => {\n        sendAdoptedStyleSheetsUpdate(document);\n    });\n    app.nodes.attachNodeCallback((node) => {\n        if (hasAdoptedSS(node)) {\n            sendAdoptedStyleSheetsUpdate(node);\n        }\n    });\n}\nexports.default = default_1;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}