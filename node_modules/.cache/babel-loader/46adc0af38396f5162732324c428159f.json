{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nconst constructedStyleSheets_js_1 = require(\"./constructedStyleSheets.js\");\nfunction default_1(app) {\n  if (app === null) {\n    return;\n  }\n  if (!window.CSSStyleSheet) {\n    app.send((0, messages_gen_js_1.TechnicalInfo)('no_stylesheet_prototype_in_window', ''));\n    return;\n  }\n  const sendInsertDeleteRule = app.safe((sheet, index, rule) => {\n    const sheetID = constructedStyleSheets_js_1.styleSheetIDMap.get(sheet);\n    if (!sheetID) {\n      // OK-case. Sheet haven't been registered yet. Rules will be sent on registration.\n      return;\n    }\n    if (typeof rule === 'string') {\n      app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, rule, index, app.getBaseHref()));\n    } else {\n      app.send((0, messages_gen_js_1.AdoptedSSDeleteRule)(sheetID, index));\n    }\n  });\n  // TODO: proper rule insertion/removal (how?)\n  const sendReplaceGroupingRule = app.safe(rule => {\n    let topmostRule = rule;\n    while (topmostRule.parentRule) {\n      topmostRule = topmostRule.parentRule;\n    }\n    const sheet = topmostRule.parentStyleSheet;\n    if (!sheet) {\n      app.debug.warn('No parent StyleSheet found for', topmostRule, rule);\n      return;\n    }\n    const sheetID = constructedStyleSheets_js_1.styleSheetIDMap.get(sheet);\n    if (!sheetID) {\n      app.debug.warn('No sheedID found for', sheet, constructedStyleSheets_js_1.styleSheetIDMap);\n      return;\n    }\n    const cssText = topmostRule.cssText;\n    const ruleList = sheet.cssRules;\n    const idx = Array.from(ruleList).indexOf(topmostRule);\n    if (idx >= 0) {\n      app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, cssText, idx, app.getBaseHref()));\n      app.send((0, messages_gen_js_1.AdoptedSSDeleteRule)(sheetID, idx + 1)); // Remove previous clone\n    } else {\n      app.debug.warn('Rule index not found in', sheet, topmostRule);\n    }\n  });\n  const patchContext = app.safe(context => {\n    const {\n      insertRule,\n      deleteRule\n    } = context.CSSStyleSheet.prototype;\n    const {\n      insertRule: groupInsertRule,\n      deleteRule: groupDeleteRule\n    } = context.CSSGroupingRule.prototype;\n    context.CSSStyleSheet.prototype.insertRule = function (rule, index = 0) {\n      sendInsertDeleteRule(this, index, rule);\n      return insertRule.call(this, rule, index);\n    };\n    context.CSSStyleSheet.prototype.deleteRule = function (index) {\n      sendInsertDeleteRule(this, index);\n      return deleteRule.call(this, index);\n    };\n    context.CSSGroupingRule.prototype.insertRule = function (rule, index = 0) {\n      const result = groupInsertRule.call(this, rule, index);\n      sendReplaceGroupingRule(this);\n      return result;\n    };\n    context.CSSGroupingRule.prototype.deleteRule = function (index = 0) {\n      const result = groupDeleteRule.call(this, index);\n      sendReplaceGroupingRule(this);\n      return result;\n    };\n  });\n  patchContext(window);\n  app.observer.attachContextCallback(patchContext);\n  app.nodes.attachNodeCallback(node => {\n    if (!(0, guards_js_1.hasTag)(node, 'style') || !node.sheet) {\n      return;\n    }\n    if (node.textContent !== null && node.textContent.trim().length > 0) {\n      return; // Non-virtual styles captured by the observer as a text\n    }\n    const nodeID = app.nodes.getID(node);\n    if (!nodeID) {\n      return;\n    }\n    const sheet = node.sheet;\n    const sheetID = (0, constructedStyleSheets_js_1.nextID)();\n    constructedStyleSheets_js_1.styleSheetIDMap.set(sheet, sheetID);\n    app.send((0, messages_gen_js_1.AdoptedSSAddOwner)(sheetID, nodeID));\n    const rules = sheet.cssRules;\n    for (let i = 0; i < rules.length; i++) {\n      sendInsertDeleteRule(sheet, i, rules[i].cssText);\n    }\n  });\n}\nexports.default = default_1;","map":{"version":3,"names":["Object","defineProperty","exports","value","messages_gen_js_1","require","guards_js_1","constructedStyleSheets_js_1","default_1","app","window","CSSStyleSheet","send","TechnicalInfo","sendInsertDeleteRule","safe","sheet","index","rule","sheetID","styleSheetIDMap","get","AdoptedSSInsertRuleURLBased","getBaseHref","AdoptedSSDeleteRule","sendReplaceGroupingRule","topmostRule","parentRule","parentStyleSheet","debug","warn","cssText","ruleList","cssRules","idx","Array","from","indexOf","patchContext","context","insertRule","deleteRule","prototype","groupInsertRule","groupDeleteRule","CSSGroupingRule","call","result","observer","attachContextCallback","nodes","attachNodeCallback","node","hasTag","textContent","trim","length","nodeID","getID","nextID","set","AdoptedSSAddOwner","rules","i","default"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/modules/cssrules.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nconst constructedStyleSheets_js_1 = require(\"./constructedStyleSheets.js\");\nfunction default_1(app) {\n    if (app === null) {\n        return;\n    }\n    if (!window.CSSStyleSheet) {\n        app.send((0, messages_gen_js_1.TechnicalInfo)('no_stylesheet_prototype_in_window', ''));\n        return;\n    }\n    const sendInsertDeleteRule = app.safe((sheet, index, rule) => {\n        const sheetID = constructedStyleSheets_js_1.styleSheetIDMap.get(sheet);\n        if (!sheetID) {\n            // OK-case. Sheet haven't been registered yet. Rules will be sent on registration.\n            return;\n        }\n        if (typeof rule === 'string') {\n            app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, rule, index, app.getBaseHref()));\n        }\n        else {\n            app.send((0, messages_gen_js_1.AdoptedSSDeleteRule)(sheetID, index));\n        }\n    });\n    // TODO: proper rule insertion/removal (how?)\n    const sendReplaceGroupingRule = app.safe((rule) => {\n        let topmostRule = rule;\n        while (topmostRule.parentRule) {\n            topmostRule = topmostRule.parentRule;\n        }\n        const sheet = topmostRule.parentStyleSheet;\n        if (!sheet) {\n            app.debug.warn('No parent StyleSheet found for', topmostRule, rule);\n            return;\n        }\n        const sheetID = constructedStyleSheets_js_1.styleSheetIDMap.get(sheet);\n        if (!sheetID) {\n            app.debug.warn('No sheedID found for', sheet, constructedStyleSheets_js_1.styleSheetIDMap);\n            return;\n        }\n        const cssText = topmostRule.cssText;\n        const ruleList = sheet.cssRules;\n        const idx = Array.from(ruleList).indexOf(topmostRule);\n        if (idx >= 0) {\n            app.send((0, messages_gen_js_1.AdoptedSSInsertRuleURLBased)(sheetID, cssText, idx, app.getBaseHref()));\n            app.send((0, messages_gen_js_1.AdoptedSSDeleteRule)(sheetID, idx + 1)); // Remove previous clone\n        }\n        else {\n            app.debug.warn('Rule index not found in', sheet, topmostRule);\n        }\n    });\n    const patchContext = app.safe((context) => {\n        const { insertRule, deleteRule } = context.CSSStyleSheet.prototype;\n        const { insertRule: groupInsertRule, deleteRule: groupDeleteRule } = context.CSSGroupingRule.prototype;\n        context.CSSStyleSheet.prototype.insertRule = function (rule, index = 0) {\n            sendInsertDeleteRule(this, index, rule);\n            return insertRule.call(this, rule, index);\n        };\n        context.CSSStyleSheet.prototype.deleteRule = function (index) {\n            sendInsertDeleteRule(this, index);\n            return deleteRule.call(this, index);\n        };\n        context.CSSGroupingRule.prototype.insertRule = function (rule, index = 0) {\n            const result = groupInsertRule.call(this, rule, index);\n            sendReplaceGroupingRule(this);\n            return result;\n        };\n        context.CSSGroupingRule.prototype.deleteRule = function (index = 0) {\n            const result = groupDeleteRule.call(this, index);\n            sendReplaceGroupingRule(this);\n            return result;\n        };\n    });\n    patchContext(window);\n    app.observer.attachContextCallback(patchContext);\n    app.nodes.attachNodeCallback((node) => {\n        if (!(0, guards_js_1.hasTag)(node, 'style') || !node.sheet) {\n            return;\n        }\n        if (node.textContent !== null && node.textContent.trim().length > 0) {\n            return; // Non-virtual styles captured by the observer as a text\n        }\n        const nodeID = app.nodes.getID(node);\n        if (!nodeID) {\n            return;\n        }\n        const sheet = node.sheet;\n        const sheetID = (0, constructedStyleSheets_js_1.nextID)();\n        constructedStyleSheets_js_1.styleSheetIDMap.set(sheet, sheetID);\n        app.send((0, messages_gen_js_1.AdoptedSSAddOwner)(sheetID, nodeID));\n        const rules = sheet.cssRules;\n        for (let i = 0; i < rules.length; i++) {\n            sendInsertDeleteRule(sheet, i, rules[i].cssText);\n        }\n    });\n}\nexports.default = default_1;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}