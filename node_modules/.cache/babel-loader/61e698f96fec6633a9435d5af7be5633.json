{"ast":null,"code":"import { generateRandomId } from '../utils.js';\nexport default class Session {\n  constructor(app, options) {\n    this.app = app;\n    this.options = options;\n    this.metadata = {};\n    this.userID = null;\n    this.callbacks = [];\n    this.timestamp = 0;\n    this.createTabId();\n  }\n  attachUpdateCallback(cb) {\n    this.callbacks.push(cb);\n  }\n  handleUpdate(newInfo) {\n    if (newInfo.userID == null) {\n      delete newInfo.userID;\n    }\n    if (newInfo.sessionID == null) {\n      delete newInfo.sessionID;\n    }\n    this.callbacks.forEach(cb => cb(newInfo));\n  }\n  assign(newInfo) {\n    if (newInfo.userID !== undefined) {\n      // TODO clear nullable/undefinable types\n      this.userID = newInfo.userID;\n    }\n    if (newInfo.metadata !== undefined) {\n      Object.entries(newInfo.metadata).forEach(([k, v]) => this.metadata[k] = v);\n    }\n    if (newInfo.sessionID !== undefined) {\n      this.sessionID = newInfo.sessionID;\n    }\n    if (newInfo.timestamp !== undefined) {\n      this.timestamp = newInfo.timestamp;\n    }\n    if (newInfo.projectID !== undefined) {\n      this.projectID = newInfo.projectID;\n    }\n    this.handleUpdate(newInfo);\n  }\n  setMetadata(key, value) {\n    this.metadata[key] = value;\n    this.handleUpdate({\n      metadata: {\n        [key]: value\n      }\n    });\n  }\n  setUserID(userID) {\n    this.userID = userID;\n    this.handleUpdate({\n      userID\n    });\n  }\n  setUserInfo(userInfo) {\n    this.userInfo = userInfo;\n  }\n  getPageNumber() {\n    const pageNoStr = this.app.sessionStorage.getItem(this.options.session_pageno_key);\n    if (pageNoStr == null) {\n      return undefined;\n    }\n    return parseInt(pageNoStr);\n  }\n  incPageNo() {\n    let pageNo = this.getPageNumber();\n    if (pageNo === undefined) {\n      pageNo = 0;\n    } else {\n      pageNo++;\n    }\n    this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNo.toString());\n    return pageNo;\n  }\n  getSessionToken() {\n    return this.app.sessionStorage.getItem(this.options.session_token_key) || undefined;\n  }\n  setSessionToken(token) {\n    this.app.sessionStorage.setItem(this.options.session_token_key, token);\n  }\n  applySessionHash(hash) {\n    const hashParts = decodeURI(hash).split('&');\n    let token = hash;\n    let pageNoStr = '100500'; // back-compat for sessionToken\n    if (hashParts.length == 2) {\n      ;\n      [pageNoStr, token] = hashParts;\n    }\n    if (!pageNoStr || !token) {\n      return;\n    }\n    this.app.sessionStorage.setItem(this.options.session_token_key, token);\n    this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNoStr);\n  }\n  getSessionHash() {\n    const pageNo = this.getPageNumber();\n    const token = this.getSessionToken();\n    if (pageNo === undefined || token === undefined) {\n      return;\n    }\n    return encodeURI(String(pageNo) + '&' + token);\n  }\n  getTabId() {\n    if (!this.tabId) this.createTabId();\n    return this.tabId;\n  }\n  regenerateTabId() {\n    const randomId = generateRandomId(12);\n    this.app.sessionStorage.setItem(this.options.session_tabid_key, randomId);\n    this.tabId = randomId;\n  }\n  createTabId() {\n    const localId = this.app.sessionStorage.getItem(this.options.session_tabid_key);\n    if (localId) {\n      this.tabId = localId;\n    } else {\n      this.regenerateTabId();\n    }\n  }\n  getInfo() {\n    return {\n      sessionID: this.sessionID,\n      metadata: this.metadata,\n      userID: this.userID,\n      timestamp: this.timestamp,\n      projectID: this.projectID\n    };\n  }\n  reset() {\n    this.app.sessionStorage.removeItem(this.options.session_token_key);\n    this.metadata = {};\n    this.userID = null;\n    this.sessionID = undefined;\n    this.timestamp = 0;\n  }\n}","map":{"version":3,"names":["generateRandomId","Session","constructor","app","options","metadata","userID","callbacks","timestamp","createTabId","attachUpdateCallback","cb","push","handleUpdate","newInfo","sessionID","forEach","assign","undefined","Object","entries","k","v","projectID","setMetadata","key","value","setUserID","setUserInfo","userInfo","getPageNumber","pageNoStr","sessionStorage","getItem","session_pageno_key","parseInt","incPageNo","pageNo","setItem","toString","getSessionToken","session_token_key","setSessionToken","token","applySessionHash","hash","hashParts","decodeURI","split","length","getSessionHash","encodeURI","String","getTabId","tabId","regenerateTabId","randomId","session_tabid_key","localId","getInfo","reset","removeItem"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/lib/app/session.js"],"sourcesContent":["import { generateRandomId } from '../utils.js';\nexport default class Session {\n    constructor(app, options) {\n        this.app = app;\n        this.options = options;\n        this.metadata = {};\n        this.userID = null;\n        this.callbacks = [];\n        this.timestamp = 0;\n        this.createTabId();\n    }\n    attachUpdateCallback(cb) {\n        this.callbacks.push(cb);\n    }\n    handleUpdate(newInfo) {\n        if (newInfo.userID == null) {\n            delete newInfo.userID;\n        }\n        if (newInfo.sessionID == null) {\n            delete newInfo.sessionID;\n        }\n        this.callbacks.forEach((cb) => cb(newInfo));\n    }\n    assign(newInfo) {\n        if (newInfo.userID !== undefined) {\n            // TODO clear nullable/undefinable types\n            this.userID = newInfo.userID;\n        }\n        if (newInfo.metadata !== undefined) {\n            Object.entries(newInfo.metadata).forEach(([k, v]) => (this.metadata[k] = v));\n        }\n        if (newInfo.sessionID !== undefined) {\n            this.sessionID = newInfo.sessionID;\n        }\n        if (newInfo.timestamp !== undefined) {\n            this.timestamp = newInfo.timestamp;\n        }\n        if (newInfo.projectID !== undefined) {\n            this.projectID = newInfo.projectID;\n        }\n        this.handleUpdate(newInfo);\n    }\n    setMetadata(key, value) {\n        this.metadata[key] = value;\n        this.handleUpdate({ metadata: { [key]: value } });\n    }\n    setUserID(userID) {\n        this.userID = userID;\n        this.handleUpdate({ userID });\n    }\n    setUserInfo(userInfo) {\n        this.userInfo = userInfo;\n    }\n    getPageNumber() {\n        const pageNoStr = this.app.sessionStorage.getItem(this.options.session_pageno_key);\n        if (pageNoStr == null) {\n            return undefined;\n        }\n        return parseInt(pageNoStr);\n    }\n    incPageNo() {\n        let pageNo = this.getPageNumber();\n        if (pageNo === undefined) {\n            pageNo = 0;\n        }\n        else {\n            pageNo++;\n        }\n        this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNo.toString());\n        return pageNo;\n    }\n    getSessionToken() {\n        return this.app.sessionStorage.getItem(this.options.session_token_key) || undefined;\n    }\n    setSessionToken(token) {\n        this.app.sessionStorage.setItem(this.options.session_token_key, token);\n    }\n    applySessionHash(hash) {\n        const hashParts = decodeURI(hash).split('&');\n        let token = hash;\n        let pageNoStr = '100500'; // back-compat for sessionToken\n        if (hashParts.length == 2) {\n            ;\n            [pageNoStr, token] = hashParts;\n        }\n        if (!pageNoStr || !token) {\n            return;\n        }\n        this.app.sessionStorage.setItem(this.options.session_token_key, token);\n        this.app.sessionStorage.setItem(this.options.session_pageno_key, pageNoStr);\n    }\n    getSessionHash() {\n        const pageNo = this.getPageNumber();\n        const token = this.getSessionToken();\n        if (pageNo === undefined || token === undefined) {\n            return;\n        }\n        return encodeURI(String(pageNo) + '&' + token);\n    }\n    getTabId() {\n        if (!this.tabId)\n            this.createTabId();\n        return this.tabId;\n    }\n    regenerateTabId() {\n        const randomId = generateRandomId(12);\n        this.app.sessionStorage.setItem(this.options.session_tabid_key, randomId);\n        this.tabId = randomId;\n    }\n    createTabId() {\n        const localId = this.app.sessionStorage.getItem(this.options.session_tabid_key);\n        if (localId) {\n            this.tabId = localId;\n        }\n        else {\n            this.regenerateTabId();\n        }\n    }\n    getInfo() {\n        return {\n            sessionID: this.sessionID,\n            metadata: this.metadata,\n            userID: this.userID,\n            timestamp: this.timestamp,\n            projectID: this.projectID,\n        };\n    }\n    reset() {\n        this.app.sessionStorage.removeItem(this.options.session_token_key);\n        this.metadata = {};\n        this.userID = null;\n        this.sessionID = undefined;\n        this.timestamp = 0;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}