{"ast":null,"code":"import { TEST_START, TASK_IND, SESSION_ID } from './utils.js';\nexport default class SignalManager {\n  constructor(ingestPoint, getTimestamp, token, testId, storageKey, setStorageKey, removeStorageKey, getStorageKey, getSessionId) {\n    this.ingestPoint = ingestPoint;\n    this.getTimestamp = getTimestamp;\n    this.token = token;\n    this.testId = testId;\n    this.storageKey = storageKey;\n    this.setStorageKey = setStorageKey;\n    this.removeStorageKey = removeStorageKey;\n    this.getStorageKey = getStorageKey;\n    this.getSessionId = getSessionId;\n    this.durations = {\n      testStart: 0,\n      tasks: []\n    };\n    this.getDurations = () => {\n      return this.durations;\n    };\n    this.setDurations = durations => {\n      this.durations.testStart = durations.testStart;\n      this.durations.tasks = durations.tasks;\n    };\n    this.signalTask = (taskId, status, taskAnswer) => {\n      if (!taskId) return console.error('User Testing: No Task ID Given');\n      const taskStart = this.durations.tasks.find(t => t.taskId === taskId);\n      const timestamp = this.getTimestamp();\n      const duration = taskStart ? timestamp - taskStart.started : 0;\n      return fetch(`${this.ingestPoint}/v1/web/uxt/signals/task`, {\n        method: 'POST',\n        headers: {\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          Authorization: `Bearer ${this.token}`\n        },\n        body: JSON.stringify({\n          testId: this.testId,\n          taskId,\n          status,\n          duration,\n          timestamp,\n          taskAnswer\n        })\n      });\n    };\n    this.signalTest = status => {\n      const timestamp = this.getTimestamp();\n      if (status === 'begin' && this.testId) {\n        const sessionId = this.getSessionId();\n        this.setStorageKey(SESSION_ID, sessionId);\n        this.setStorageKey(this.storageKey, this.testId.toString());\n        this.setStorageKey(TEST_START, timestamp.toString());\n      } else {\n        this.removeStorageKey(this.storageKey);\n        this.removeStorageKey(TASK_IND);\n        this.removeStorageKey(TEST_START);\n      }\n      const start = this.durations.testStart || timestamp;\n      const duration = timestamp - start;\n      return fetch(`${this.ingestPoint}/v1/web/uxt/signals/test`, {\n        method: 'POST',\n        headers: {\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          Authorization: `Bearer ${this.token}`\n        },\n        body: JSON.stringify({\n          testId: this.testId,\n          status,\n          duration,\n          timestamp\n        })\n      });\n    };\n    const possibleStart = this.getStorageKey(TEST_START);\n    if (possibleStart) {\n      this.durations.testStart = parseInt(possibleStart, 10);\n    }\n  }\n}","map":{"version":3,"names":["TEST_START","TASK_IND","SESSION_ID","SignalManager","constructor","ingestPoint","getTimestamp","token","testId","storageKey","setStorageKey","removeStorageKey","getStorageKey","getSessionId","durations","testStart","tasks","getDurations","setDurations","signalTask","taskId","status","taskAnswer","console","error","taskStart","find","t","timestamp","duration","started","fetch","method","headers","Authorization","body","JSON","stringify","signalTest","sessionId","toString","start","possibleStart","parseInt"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/lib/modules/userTesting/SignalManager.js"],"sourcesContent":["import { TEST_START, TASK_IND, SESSION_ID } from './utils.js';\nexport default class SignalManager {\n    constructor(ingestPoint, getTimestamp, token, testId, storageKey, setStorageKey, removeStorageKey, getStorageKey, getSessionId) {\n        this.ingestPoint = ingestPoint;\n        this.getTimestamp = getTimestamp;\n        this.token = token;\n        this.testId = testId;\n        this.storageKey = storageKey;\n        this.setStorageKey = setStorageKey;\n        this.removeStorageKey = removeStorageKey;\n        this.getStorageKey = getStorageKey;\n        this.getSessionId = getSessionId;\n        this.durations = {\n            testStart: 0,\n            tasks: [],\n        };\n        this.getDurations = () => {\n            return this.durations;\n        };\n        this.setDurations = (durations) => {\n            this.durations.testStart = durations.testStart;\n            this.durations.tasks = durations.tasks;\n        };\n        this.signalTask = (taskId, status, taskAnswer) => {\n            if (!taskId)\n                return console.error('User Testing: No Task ID Given');\n            const taskStart = this.durations.tasks.find((t) => t.taskId === taskId);\n            const timestamp = this.getTimestamp();\n            const duration = taskStart ? timestamp - taskStart.started : 0;\n            return fetch(`${this.ingestPoint}/v1/web/uxt/signals/task`, {\n                method: 'POST',\n                headers: {\n                    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                    Authorization: `Bearer ${this.token}`,\n                },\n                body: JSON.stringify({\n                    testId: this.testId,\n                    taskId,\n                    status,\n                    duration,\n                    timestamp,\n                    taskAnswer,\n                }),\n            });\n        };\n        this.signalTest = (status) => {\n            const timestamp = this.getTimestamp();\n            if (status === 'begin' && this.testId) {\n                const sessionId = this.getSessionId();\n                this.setStorageKey(SESSION_ID, sessionId);\n                this.setStorageKey(this.storageKey, this.testId.toString());\n                this.setStorageKey(TEST_START, timestamp.toString());\n            }\n            else {\n                this.removeStorageKey(this.storageKey);\n                this.removeStorageKey(TASK_IND);\n                this.removeStorageKey(TEST_START);\n            }\n            const start = this.durations.testStart || timestamp;\n            const duration = timestamp - start;\n            return fetch(`${this.ingestPoint}/v1/web/uxt/signals/test`, {\n                method: 'POST',\n                headers: {\n                    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                    Authorization: `Bearer ${this.token}`,\n                },\n                body: JSON.stringify({\n                    testId: this.testId,\n                    status,\n                    duration,\n                    timestamp,\n                }),\n            });\n        };\n        const possibleStart = this.getStorageKey(TEST_START);\n        if (possibleStart) {\n            this.durations.testStart = parseInt(possibleStart, 10);\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}