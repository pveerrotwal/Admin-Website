{"ast":null,"code":"import { SetViewportScroll, SetNodeScroll } from '../app/messages.gen.js';\nimport { isNode, isElementNode, isRootNode, isDocument } from '../app/guards.js';\nfunction getDocumentScroll(doc) {\n  const win = doc.defaultView;\n  return [win && win.pageXOffset || doc.documentElement && doc.documentElement.scrollLeft || doc.body && doc.body.scrollLeft || 0, win && win.pageYOffset || doc.documentElement && doc.documentElement.scrollTop || doc.body && doc.body.scrollTop || 0];\n}\nexport default function (app) {\n  let documentScroll = false;\n  const nodeScroll = new Map();\n  function setNodeScroll(target) {\n    if (!isNode(target)) {\n      return;\n    }\n    if (isElementNode(target)) {\n      nodeScroll.set(target, [target.scrollLeft, target.scrollTop]);\n    }\n    if (isDocument(target)) {\n      nodeScroll.set(target, getDocumentScroll(target));\n    }\n  }\n  const sendSetViewportScroll = app.safe(() => app.send(SetViewportScroll(...getDocumentScroll(document))));\n  const sendSetNodeScroll = app.safe((s, node) => {\n    const id = app.nodes.getID(node);\n    if (id !== undefined) {\n      app.send(SetNodeScroll(id, s[0], s[1]));\n    }\n  });\n  app.attachStartCallback(sendSetViewportScroll);\n  app.attachStopCallback(() => {\n    documentScroll = false;\n    nodeScroll.clear();\n  });\n  app.nodes.attachNodeCallback((node, isStart) => {\n    // MBTODO: iterate over all the nodes on start instead of using isStart hack\n    if (isStart) {\n      if (isElementNode(node) && node.scrollLeft + node.scrollTop > 0) {\n        nodeScroll.set(node, [node.scrollLeft, node.scrollTop]);\n      } else if (isDocument(node)) {\n        // DRY somehow?\n        nodeScroll.set(node, getDocumentScroll(node));\n      }\n    }\n    if (isRootNode(node)) {\n      // scroll is not-composed event (https://javascript.info/shadow-dom-events)\n      app.nodes.attachNodeListener(node, 'scroll', e => {\n        setNodeScroll(e.target);\n      });\n    }\n  });\n  app.attachEventListener(document, 'scroll', e => {\n    const target = e.target;\n    if (target === document) {\n      documentScroll = true;\n      return;\n    }\n    setNodeScroll(target);\n  });\n  app.ticker.attach(() => {\n    if (documentScroll) {\n      sendSetViewportScroll();\n      documentScroll = false;\n    }\n    nodeScroll.forEach(sendSetNodeScroll);\n    nodeScroll.clear();\n  }, 5, false);\n}","map":{"version":3,"names":["SetViewportScroll","SetNodeScroll","isNode","isElementNode","isRootNode","isDocument","getDocumentScroll","doc","win","defaultView","pageXOffset","documentElement","scrollLeft","body","pageYOffset","scrollTop","app","documentScroll","nodeScroll","Map","setNodeScroll","target","set","sendSetViewportScroll","safe","send","document","sendSetNodeScroll","s","node","id","nodes","getID","undefined","attachStartCallback","attachStopCallback","clear","attachNodeCallback","isStart","attachNodeListener","e","attachEventListener","ticker","attach","forEach"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/lib/modules/scroll.js"],"sourcesContent":["import { SetViewportScroll, SetNodeScroll } from '../app/messages.gen.js';\nimport { isNode, isElementNode, isRootNode, isDocument } from '../app/guards.js';\nfunction getDocumentScroll(doc) {\n    const win = doc.defaultView;\n    return [\n        (win && win.pageXOffset) ||\n            (doc.documentElement && doc.documentElement.scrollLeft) ||\n            (doc.body && doc.body.scrollLeft) ||\n            0,\n        (win && win.pageYOffset) ||\n            (doc.documentElement && doc.documentElement.scrollTop) ||\n            (doc.body && doc.body.scrollTop) ||\n            0,\n    ];\n}\nexport default function (app) {\n    let documentScroll = false;\n    const nodeScroll = new Map();\n    function setNodeScroll(target) {\n        if (!isNode(target)) {\n            return;\n        }\n        if (isElementNode(target)) {\n            nodeScroll.set(target, [target.scrollLeft, target.scrollTop]);\n        }\n        if (isDocument(target)) {\n            nodeScroll.set(target, getDocumentScroll(target));\n        }\n    }\n    const sendSetViewportScroll = app.safe(() => app.send(SetViewportScroll(...getDocumentScroll(document))));\n    const sendSetNodeScroll = app.safe((s, node) => {\n        const id = app.nodes.getID(node);\n        if (id !== undefined) {\n            app.send(SetNodeScroll(id, s[0], s[1]));\n        }\n    });\n    app.attachStartCallback(sendSetViewportScroll);\n    app.attachStopCallback(() => {\n        documentScroll = false;\n        nodeScroll.clear();\n    });\n    app.nodes.attachNodeCallback((node, isStart) => {\n        // MBTODO: iterate over all the nodes on start instead of using isStart hack\n        if (isStart) {\n            if (isElementNode(node) && node.scrollLeft + node.scrollTop > 0) {\n                nodeScroll.set(node, [node.scrollLeft, node.scrollTop]);\n            }\n            else if (isDocument(node)) {\n                // DRY somehow?\n                nodeScroll.set(node, getDocumentScroll(node));\n            }\n        }\n        if (isRootNode(node)) {\n            // scroll is not-composed event (https://javascript.info/shadow-dom-events)\n            app.nodes.attachNodeListener(node, 'scroll', (e) => {\n                setNodeScroll(e.target);\n            });\n        }\n    });\n    app.attachEventListener(document, 'scroll', (e) => {\n        const target = e.target;\n        if (target === document) {\n            documentScroll = true;\n            return;\n        }\n        setNodeScroll(target);\n    });\n    app.ticker.attach(() => {\n        if (documentScroll) {\n            sendSetViewportScroll();\n            documentScroll = false;\n        }\n        nodeScroll.forEach(sendSetNodeScroll);\n        nodeScroll.clear();\n    }, 5, false);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}