{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WATCHED_TAGS_KEY = void 0;\nexports.WATCHED_TAGS_KEY = '__or__watched_tags__';\nclass TagWatcher {\n  constructor(sessionStorage, errLog, onTag) {\n    var _a;\n    this.sessionStorage = sessionStorage;\n    this.errLog = errLog;\n    this.onTag = onTag;\n    this.intervals = {};\n    this.tags = [];\n    const tags = JSON.parse((_a = sessionStorage.getItem(exports.WATCHED_TAGS_KEY)) !== null && _a !== void 0 ? _a : '[]');\n    this.setTags(tags);\n    this.observer = new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          if (entry.target) {\n            // @ts-ignore\n            const tag = entry.target.__or_watcher_tagname;\n            if (tag) {\n              this.onTagRendered(tag);\n            }\n            this.observer.unobserve(entry.target);\n          }\n        }\n      });\n    });\n  }\n  async fetchTags(ingest, token) {\n    return fetch(`${ingest}/v1/web/tags`, {\n      method: 'GET',\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    }).then(r => r.json()).then(({\n      tags\n    }) => {\n      if (tags && tags.length) {\n        this.setTags(tags);\n        const tagString = JSON.stringify(tags);\n        this.sessionStorage.setItem(exports.WATCHED_TAGS_KEY, tagString || '');\n      }\n    }).catch(e => this.errLog(e));\n  }\n  setTags(tags) {\n    this.tags = tags;\n    this.intervals = {};\n    tags.forEach(tag => {\n      this.intervals[tag.id] = setInterval(() => {\n        const possibleEls = document.querySelectorAll(tag.selector);\n        if (possibleEls.length > 0) {\n          const el = possibleEls[0];\n          // @ts-ignore\n          el.__or_watcher_tagname = tag.id;\n          this.observer.observe(el);\n        }\n      }, 500);\n    });\n  }\n  onTagRendered(tagId) {\n    if (this.intervals[tagId]) {\n      clearInterval(this.intervals[tagId]);\n    }\n    this.onTag(tagId);\n  }\n  clear() {\n    this.tags.forEach(tag => {\n      clearInterval(this.intervals[tag.id]);\n    });\n    this.tags = [];\n    this.intervals = {};\n    this.observer.disconnect();\n  }\n}\nexports.default = TagWatcher;","map":{"version":3,"names":["Object","defineProperty","exports","value","WATCHED_TAGS_KEY","TagWatcher","constructor","sessionStorage","errLog","onTag","_a","intervals","tags","JSON","parse","getItem","setTags","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","target","tag","__or_watcher_tagname","onTagRendered","unobserve","fetchTags","ingest","token","fetch","method","headers","Authorization","then","r","json","length","tagString","stringify","setItem","catch","e","id","setInterval","possibleEls","document","querySelectorAll","selector","el","observe","tagId","clearInterval","clear","disconnect","default"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/modules/tagWatcher.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WATCHED_TAGS_KEY = void 0;\nexports.WATCHED_TAGS_KEY = '__or__watched_tags__';\nclass TagWatcher {\n    constructor(sessionStorage, errLog, onTag) {\n        var _a;\n        this.sessionStorage = sessionStorage;\n        this.errLog = errLog;\n        this.onTag = onTag;\n        this.intervals = {};\n        this.tags = [];\n        const tags = JSON.parse((_a = sessionStorage.getItem(exports.WATCHED_TAGS_KEY)) !== null && _a !== void 0 ? _a : '[]');\n        this.setTags(tags);\n        this.observer = new IntersectionObserver((entries) => {\n            entries.forEach((entry) => {\n                if (entry.isIntersecting) {\n                    if (entry.target) {\n                        // @ts-ignore\n                        const tag = entry.target.__or_watcher_tagname;\n                        if (tag) {\n                            this.onTagRendered(tag);\n                        }\n                        this.observer.unobserve(entry.target);\n                    }\n                }\n            });\n        });\n    }\n    async fetchTags(ingest, token) {\n        return fetch(`${ingest}/v1/web/tags`, {\n            method: 'GET',\n            headers: {\n                Authorization: `Bearer ${token}`,\n            },\n        })\n            .then((r) => r.json())\n            .then(({ tags }) => {\n            if (tags && tags.length) {\n                this.setTags(tags);\n                const tagString = JSON.stringify(tags);\n                this.sessionStorage.setItem(exports.WATCHED_TAGS_KEY, tagString || '');\n            }\n        })\n            .catch((e) => this.errLog(e));\n    }\n    setTags(tags) {\n        this.tags = tags;\n        this.intervals = {};\n        tags.forEach((tag) => {\n            this.intervals[tag.id] = setInterval(() => {\n                const possibleEls = document.querySelectorAll(tag.selector);\n                if (possibleEls.length > 0) {\n                    const el = possibleEls[0];\n                    // @ts-ignore\n                    el.__or_watcher_tagname = tag.id;\n                    this.observer.observe(el);\n                }\n            }, 500);\n        });\n    }\n    onTagRendered(tagId) {\n        if (this.intervals[tagId]) {\n            clearInterval(this.intervals[tagId]);\n        }\n        this.onTag(tagId);\n    }\n    clear() {\n        this.tags.forEach((tag) => {\n            clearInterval(this.intervals[tag.id]);\n        });\n        this.tags = [];\n        this.intervals = {};\n        this.observer.disconnect();\n    }\n}\nexports.default = TagWatcher;\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,gBAAgB,GAAG,KAAK,CAAC;AACjCF,OAAO,CAACE,gBAAgB,GAAG,sBAAsB;AACjD,MAAMC,UAAU,CAAC;EACbC,WAAWA,CAACC,cAAc,EAAEC,MAAM,EAAEC,KAAK,EAAE;IACvC,IAAIC,EAAE;IACN,IAAI,CAACH,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACE,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAACC,IAAI,GAAG,EAAE;IACd,MAAMA,IAAI,GAAGC,IAAI,CAACC,KAAK,CAAC,CAACJ,EAAE,GAAGH,cAAc,CAACQ,OAAO,CAACb,OAAO,CAACE,gBAAgB,CAAC,MAAM,IAAI,IAAIM,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAG,IAAI,CAAC;IACtH,IAAI,CAACM,OAAO,CAACJ,IAAI,CAAC;IAClB,IAAI,CAACK,QAAQ,GAAG,IAAIC,oBAAoB,CAAEC,OAAO,IAAK;MAClDA,OAAO,CAACC,OAAO,CAAEC,KAAK,IAAK;QACvB,IAAIA,KAAK,CAACC,cAAc,EAAE;UACtB,IAAID,KAAK,CAACE,MAAM,EAAE;YACd;YACA,MAAMC,GAAG,GAAGH,KAAK,CAACE,MAAM,CAACE,oBAAoB;YAC7C,IAAID,GAAG,EAAE;cACL,IAAI,CAACE,aAAa,CAACF,GAAG,CAAC;YAC3B;YACA,IAAI,CAACP,QAAQ,CAACU,SAAS,CAACN,KAAK,CAACE,MAAM,CAAC;UACzC;QACJ;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;EACN;EACA,MAAMK,SAASA,CAACC,MAAM,EAAEC,KAAK,EAAE;IAC3B,OAAOC,KAAK,CAAE,GAAEF,MAAO,cAAa,EAAE;MAClCG,MAAM,EAAE,KAAK;MACbC,OAAO,EAAE;QACLC,aAAa,EAAG,UAASJ,KAAM;MACnC;IACJ,CAAC,CAAC,CACGK,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACrBF,IAAI,CAAC,CAAC;MAAEvB;IAAK,CAAC,KAAK;MACpB,IAAIA,IAAI,IAAIA,IAAI,CAAC0B,MAAM,EAAE;QACrB,IAAI,CAACtB,OAAO,CAACJ,IAAI,CAAC;QAClB,MAAM2B,SAAS,GAAG1B,IAAI,CAAC2B,SAAS,CAAC5B,IAAI,CAAC;QACtC,IAAI,CAACL,cAAc,CAACkC,OAAO,CAACvC,OAAO,CAACE,gBAAgB,EAAEmC,SAAS,IAAI,EAAE,CAAC;MAC1E;IACJ,CAAC,CAAC,CACGG,KAAK,CAAEC,CAAC,IAAK,IAAI,CAACnC,MAAM,CAACmC,CAAC,CAAC,CAAC;EACrC;EACA3B,OAAOA,CAACJ,IAAI,EAAE;IACV,IAAI,CAACA,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACD,SAAS,GAAG,CAAC,CAAC;IACnBC,IAAI,CAACQ,OAAO,CAAEI,GAAG,IAAK;MAClB,IAAI,CAACb,SAAS,CAACa,GAAG,CAACoB,EAAE,CAAC,GAAGC,WAAW,CAAC,MAAM;QACvC,MAAMC,WAAW,GAAGC,QAAQ,CAACC,gBAAgB,CAACxB,GAAG,CAACyB,QAAQ,CAAC;QAC3D,IAAIH,WAAW,CAACR,MAAM,GAAG,CAAC,EAAE;UACxB,MAAMY,EAAE,GAAGJ,WAAW,CAAC,CAAC,CAAC;UACzB;UACAI,EAAE,CAACzB,oBAAoB,GAAGD,GAAG,CAACoB,EAAE;UAChC,IAAI,CAAC3B,QAAQ,CAACkC,OAAO,CAACD,EAAE,CAAC;QAC7B;MACJ,CAAC,EAAE,GAAG,CAAC;IACX,CAAC,CAAC;EACN;EACAxB,aAAaA,CAAC0B,KAAK,EAAE;IACjB,IAAI,IAAI,CAACzC,SAAS,CAACyC,KAAK,CAAC,EAAE;MACvBC,aAAa,CAAC,IAAI,CAAC1C,SAAS,CAACyC,KAAK,CAAC,CAAC;IACxC;IACA,IAAI,CAAC3C,KAAK,CAAC2C,KAAK,CAAC;EACrB;EACAE,KAAKA,CAAA,EAAG;IACJ,IAAI,CAAC1C,IAAI,CAACQ,OAAO,CAAEI,GAAG,IAAK;MACvB6B,aAAa,CAAC,IAAI,CAAC1C,SAAS,CAACa,GAAG,CAACoB,EAAE,CAAC,CAAC;IACzC,CAAC,CAAC;IACF,IAAI,CAAChC,IAAI,GAAG,EAAE;IACd,IAAI,CAACD,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAACM,QAAQ,CAACsC,UAAU,CAAC,CAAC;EAC9B;AACJ;AACArD,OAAO,CAACsD,OAAO,GAAGnD,UAAU"},"metadata":{},"sourceType":"script"}