{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst utils_js_1 = require(\"../utils.js\");\nconst exception_js_1 = require(\"./exception.js\");\nfunction default_1(app, instance, opts, sanitize, stringify) {\n  app.debug.log('Openreplay: attaching axios spy to instance', instance);\n  function captureResponseData(axiosResponseObj) {\n    app.debug.log('Openreplay: capturing axios response data', axiosResponseObj);\n    const {\n      headers: reqHs,\n      data: reqData,\n      method,\n      url,\n      baseURL\n    } = axiosResponseObj.config;\n    const {\n      data: rData,\n      headers: rHs,\n      status: globStatus,\n      response\n    } = axiosResponseObj;\n    const {\n      data: resData,\n      headers: resHs,\n      status: resStatus\n    } = response || {};\n    const ihOpt = opts.ignoreHeaders;\n    const isHIgnoring = Array.isArray(ihOpt) ? name => ihOpt.includes(name) : () => ihOpt;\n    function writeHeader(hsObj, header) {\n      if (!isHIgnoring(header[0])) {\n        hsObj[header[0]] = header[1];\n      }\n    }\n    let requestHs = {};\n    let responseHs = {};\n    if (reqHs.toJSON) {\n      requestHs = reqHs.toJSON();\n    } else if (reqHs instanceof Headers) {\n      reqHs.forEach((v, n) => writeHeader(requestHs, [n, v]));\n    } else if (Array.isArray(reqHs)) {\n      reqHs.forEach(h => writeHeader(requestHs, h));\n    } else if (typeof reqHs === 'object') {\n      Object.entries(reqHs).forEach(h => writeHeader(requestHs, h));\n    }\n    const usedResHeader = resHs ? resHs : rHs;\n    if (usedResHeader.toJSON) {\n      responseHs = usedResHeader.toJSON();\n    } else if (usedResHeader instanceof Headers) {\n      usedResHeader.forEach((v, n) => writeHeader(responseHs, [n, v]));\n    } else if (Array.isArray(usedResHeader)) {\n      usedResHeader.forEach(h => writeHeader(responseHs, h));\n    } else if (typeof usedResHeader === 'object') {\n      Object.entries(usedResHeader).forEach(([n, v]) => {\n        if (!isHIgnoring(n)) responseHs[n] = v;\n      });\n    }\n    const reqResInfo = sanitize({\n      url,\n      method: method || '',\n      status: globStatus || resStatus || 0,\n      request: {\n        headers: requestHs,\n        body: reqData\n      },\n      response: {\n        headers: responseHs,\n        body: resData || rData\n      }\n    });\n    if (!reqResInfo) {\n      app.debug.log('Openreplay: empty request/response info, skipping');\n      return;\n    }\n    const requestStart = axiosResponseObj.config.__openreplay_timing;\n    const duration = performance.now() - requestStart;\n    app.debug.log('Openreplay: final req object', reqResInfo);\n    app.send((0, messages_gen_js_1.NetworkRequest)('xhr', String(method), String(reqResInfo.url), stringify(reqResInfo.request), stringify(reqResInfo.response), reqResInfo.status, requestStart + (0, utils_js_1.getTimeOrigin)(), duration, 0));\n  }\n  function getStartTime(config) {\n    app.debug.log('Openreplay: capturing API request', config);\n    config.__openreplay_timing = performance.now();\n    if (opts.sessionTokenHeader) {\n      const header = typeof opts.sessionTokenHeader === 'string' ? opts.sessionTokenHeader : 'X-OpenReplay-Session-Token';\n      const headerValue = app.getSessionToken();\n      if (headerValue) {\n        config.headers.set(header, headerValue);\n      }\n    }\n    return config;\n  }\n  function captureNetworkRequest(response) {\n    if (opts.failuresOnly) return response;\n    captureResponseData(response);\n    return response;\n  }\n  function captureNetworkError(error) {\n    app.debug.log('Openreplay: capturing API request error', error);\n    if (isAxiosError(error) && Boolean(error.response)) {\n      captureResponseData(error.response);\n    } else if (error instanceof Error) {\n      app.send((0, exception_js_1.getExceptionMessage)(error, []));\n    }\n    return Promise.reject(error);\n  }\n  function logRequestError(ev) {\n    app.debug.log('Openreplay: failed API request, skipping', ev);\n  }\n  const reqInt = instance.interceptors.request.use(getStartTime, logRequestError, {\n    synchronous: true\n  });\n  const resInt = instance.interceptors.response.use(captureNetworkRequest, captureNetworkError, {\n    synchronous: true\n  });\n  app.attachStopCallback(() => {\n    var _a, _b, _c, _d;\n    (_b = (_a = instance.interceptors.request).eject) === null || _b === void 0 ? void 0 : _b.call(_a, reqInt);\n    (_d = (_c = instance.interceptors.response).eject) === null || _d === void 0 ? void 0 : _d.call(_c, resInt);\n  });\n}\nexports.default = default_1;\nfunction isAxiosError(payload) {\n  return isObject(payload) && payload.isAxiosError === true;\n}\nfunction isObject(thing) {\n  return thing !== null && typeof thing === 'object';\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","messages_gen_js_1","require","utils_js_1","exception_js_1","default_1","app","instance","opts","sanitize","stringify","debug","log","captureResponseData","axiosResponseObj","headers","reqHs","data","reqData","method","url","baseURL","config","rData","rHs","status","globStatus","response","resData","resHs","resStatus","ihOpt","ignoreHeaders","isHIgnoring","Array","isArray","name","includes","writeHeader","hsObj","header","requestHs","responseHs","toJSON","Headers","forEach","v","n","h","entries","usedResHeader","reqResInfo","request","body","requestStart","__openreplay_timing","duration","performance","now","send","NetworkRequest","String","getTimeOrigin","getStartTime","sessionTokenHeader","headerValue","getSessionToken","set","captureNetworkRequest","failuresOnly","captureNetworkError","error","isAxiosError","Boolean","Error","getExceptionMessage","Promise","reject","logRequestError","ev","reqInt","interceptors","use","synchronous","resInt","attachStopCallback","_a","_b","_c","_d","eject","call","default","payload","isObject","thing"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/modules/axiosSpy.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst utils_js_1 = require(\"../utils.js\");\nconst exception_js_1 = require(\"./exception.js\");\nfunction default_1(app, instance, opts, sanitize, stringify) {\n    app.debug.log('Openreplay: attaching axios spy to instance', instance);\n    function captureResponseData(axiosResponseObj) {\n        app.debug.log('Openreplay: capturing axios response data', axiosResponseObj);\n        const { headers: reqHs, data: reqData, method, url, baseURL } = axiosResponseObj.config;\n        const { data: rData, headers: rHs, status: globStatus, response } = axiosResponseObj;\n        const { data: resData, headers: resHs, status: resStatus } = response || {};\n        const ihOpt = opts.ignoreHeaders;\n        const isHIgnoring = Array.isArray(ihOpt) ? (name) => ihOpt.includes(name) : () => ihOpt;\n        function writeHeader(hsObj, header) {\n            if (!isHIgnoring(header[0])) {\n                hsObj[header[0]] = header[1];\n            }\n        }\n        let requestHs = {};\n        let responseHs = {};\n        if (reqHs.toJSON) {\n            requestHs = reqHs.toJSON();\n        }\n        else if (reqHs instanceof Headers) {\n            reqHs.forEach((v, n) => writeHeader(requestHs, [n, v]));\n        }\n        else if (Array.isArray(reqHs)) {\n            reqHs.forEach((h) => writeHeader(requestHs, h));\n        }\n        else if (typeof reqHs === 'object') {\n            Object.entries(reqHs).forEach((h) => writeHeader(requestHs, h));\n        }\n        const usedResHeader = resHs ? resHs : rHs;\n        if (usedResHeader.toJSON) {\n            responseHs = usedResHeader.toJSON();\n        }\n        else if (usedResHeader instanceof Headers) {\n            usedResHeader.forEach((v, n) => writeHeader(responseHs, [n, v]));\n        }\n        else if (Array.isArray(usedResHeader)) {\n            usedResHeader.forEach((h) => writeHeader(responseHs, h));\n        }\n        else if (typeof usedResHeader === 'object') {\n            Object.entries(usedResHeader).forEach(([n, v]) => {\n                if (!isHIgnoring(n))\n                    responseHs[n] = v;\n            });\n        }\n        const reqResInfo = sanitize({\n            url,\n            method: method || '',\n            status: globStatus || resStatus || 0,\n            request: {\n                headers: requestHs,\n                body: reqData,\n            },\n            response: {\n                headers: responseHs,\n                body: resData || rData,\n            },\n        });\n        if (!reqResInfo) {\n            app.debug.log('Openreplay: empty request/response info, skipping');\n            return;\n        }\n        const requestStart = axiosResponseObj.config.__openreplay_timing;\n        const duration = performance.now() - requestStart;\n        app.debug.log('Openreplay: final req object', reqResInfo);\n        app.send((0, messages_gen_js_1.NetworkRequest)('xhr', String(method), String(reqResInfo.url), stringify(reqResInfo.request), stringify(reqResInfo.response), reqResInfo.status, requestStart + (0, utils_js_1.getTimeOrigin)(), duration, 0));\n    }\n    function getStartTime(config) {\n        app.debug.log('Openreplay: capturing API request', config);\n        config.__openreplay_timing = performance.now();\n        if (opts.sessionTokenHeader) {\n            const header = typeof opts.sessionTokenHeader === 'string'\n                ? opts.sessionTokenHeader\n                : 'X-OpenReplay-Session-Token';\n            const headerValue = app.getSessionToken();\n            if (headerValue) {\n                config.headers.set(header, headerValue);\n            }\n        }\n        return config;\n    }\n    function captureNetworkRequest(response) {\n        if (opts.failuresOnly)\n            return response;\n        captureResponseData(response);\n        return response;\n    }\n    function captureNetworkError(error) {\n        app.debug.log('Openreplay: capturing API request error', error);\n        if (isAxiosError(error) && Boolean(error.response)) {\n            captureResponseData(error.response);\n        }\n        else if (error instanceof Error) {\n            app.send((0, exception_js_1.getExceptionMessage)(error, []));\n        }\n        return Promise.reject(error);\n    }\n    function logRequestError(ev) {\n        app.debug.log('Openreplay: failed API request, skipping', ev);\n    }\n    const reqInt = instance.interceptors.request.use(getStartTime, logRequestError, {\n        synchronous: true,\n    });\n    const resInt = instance.interceptors.response.use(captureNetworkRequest, captureNetworkError, {\n        synchronous: true,\n    });\n    app.attachStopCallback(() => {\n        var _a, _b, _c, _d;\n        (_b = (_a = instance.interceptors.request).eject) === null || _b === void 0 ? void 0 : _b.call(_a, reqInt);\n        (_d = (_c = instance.interceptors.response).eject) === null || _d === void 0 ? void 0 : _d.call(_c, resInt);\n    });\n}\nexports.default = default_1;\nfunction isAxiosError(payload) {\n    return isObject(payload) && payload.isAxiosError === true;\n}\nfunction isObject(thing) {\n    return thing !== null && typeof thing === 'object';\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}