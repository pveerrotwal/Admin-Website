{"ast":null,"code":"export default class FeatureFlags {\n  constructor(app) {\n    this.app = app;\n    this.flags = [];\n    this.storageKey = '__openreplay_flags';\n    const persistFlags = this.app.sessionStorage.getItem(this.storageKey);\n    if (persistFlags) {\n      const persistFlagsStrArr = persistFlags.split(';').filter(Boolean);\n      this.flags = persistFlagsStrArr.map(flag => JSON.parse(flag));\n    }\n  }\n  getFeatureFlag(flagName) {\n    return this.flags.find(flag => flag.key === flagName);\n  }\n  isFlagEnabled(flagName) {\n    return this.flags.findIndex(flag => flag.key === flagName) !== -1;\n  }\n  onFlagsLoad(cb) {\n    this.onFlagsCb = cb;\n  }\n  async reloadFlags(token) {\n    const persistFlagsStr = this.app.sessionStorage.getItem(this.storageKey);\n    const persistFlags = {};\n    if (persistFlagsStr) {\n      const persistArray = persistFlagsStr.split(';').filter(Boolean);\n      persistArray.forEach(flag => {\n        const flagObj = JSON.parse(flag);\n        persistFlags[flagObj.key] = {\n          key: flagObj.key,\n          value: flagObj.value\n        };\n      });\n    }\n    const sessionInfo = this.app.session.getInfo();\n    const userInfo = this.app.session.userInfo;\n    const requestObject = {\n      projectID: sessionInfo.projectID,\n      userID: sessionInfo.userID,\n      metadata: sessionInfo.metadata,\n      referrer: document.referrer,\n      os: userInfo.userOS,\n      device: userInfo.userDevice,\n      country: userInfo.userCountry,\n      state: userInfo.userState,\n      city: userInfo.userCity,\n      browser: userInfo.userBrowser,\n      persistFlags: persistFlags\n    };\n    const authToken = token !== null && token !== void 0 ? token : this.app.session.getSessionToken();\n    const resp = await fetch(this.app.options.ingestPoint + '/v1/web/feature-flags', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${authToken}`\n      },\n      body: JSON.stringify(requestObject)\n    });\n    if (resp.status === 200) {\n      const data = await resp.json();\n      return this.handleFlags(data.flags);\n    }\n  }\n  handleFlags(flags) {\n    var _a;\n    const persistFlags = [];\n    flags.forEach(flag => {\n      if (flag.is_persist) persistFlags.push(flag);\n    });\n    let str = '';\n    const uniquePersistFlags = this.diffPersist(persistFlags);\n    uniquePersistFlags.forEach(flag => {\n      str += `${JSON.stringify(flag)};`;\n    });\n    this.app.sessionStorage.setItem(this.storageKey, str);\n    this.flags = flags;\n    return (_a = this.onFlagsCb) === null || _a === void 0 ? void 0 : _a.call(this, flags);\n  }\n  clearPersistFlags() {\n    this.app.sessionStorage.removeItem(this.storageKey);\n  }\n  diffPersist(flags) {\n    const persistFlags = this.app.sessionStorage.getItem(this.storageKey);\n    if (!persistFlags) return flags;\n    const persistFlagsStrArr = persistFlags.split(';').filter(Boolean);\n    const persistFlagsArr = persistFlagsStrArr.map(flag => JSON.parse(flag));\n    return flags.filter(flag => persistFlagsArr.findIndex(pf => pf.key === flag.key) === -1);\n  }\n}","map":{"version":3,"names":["FeatureFlags","constructor","app","flags","storageKey","persistFlags","sessionStorage","getItem","persistFlagsStrArr","split","filter","Boolean","map","flag","JSON","parse","getFeatureFlag","flagName","find","key","isFlagEnabled","findIndex","onFlagsLoad","cb","onFlagsCb","reloadFlags","token","persistFlagsStr","persistArray","forEach","flagObj","value","sessionInfo","session","getInfo","userInfo","requestObject","projectID","userID","metadata","referrer","document","os","userOS","device","userDevice","country","userCountry","state","userState","city","userCity","browser","userBrowser","authToken","getSessionToken","resp","fetch","options","ingestPoint","method","headers","Authorization","body","stringify","status","data","json","handleFlags","_a","is_persist","push","str","uniquePersistFlags","diffPersist","setItem","call","clearPersistFlags","removeItem","persistFlagsArr","pf"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/lib/modules/featureFlags.js"],"sourcesContent":["export default class FeatureFlags {\n    constructor(app) {\n        this.app = app;\n        this.flags = [];\n        this.storageKey = '__openreplay_flags';\n        const persistFlags = this.app.sessionStorage.getItem(this.storageKey);\n        if (persistFlags) {\n            const persistFlagsStrArr = persistFlags.split(';').filter(Boolean);\n            this.flags = persistFlagsStrArr.map((flag) => JSON.parse(flag));\n        }\n    }\n    getFeatureFlag(flagName) {\n        return this.flags.find((flag) => flag.key === flagName);\n    }\n    isFlagEnabled(flagName) {\n        return this.flags.findIndex((flag) => flag.key === flagName) !== -1;\n    }\n    onFlagsLoad(cb) {\n        this.onFlagsCb = cb;\n    }\n    async reloadFlags(token) {\n        const persistFlagsStr = this.app.sessionStorage.getItem(this.storageKey);\n        const persistFlags = {};\n        if (persistFlagsStr) {\n            const persistArray = persistFlagsStr.split(';').filter(Boolean);\n            persistArray.forEach((flag) => {\n                const flagObj = JSON.parse(flag);\n                persistFlags[flagObj.key] = { key: flagObj.key, value: flagObj.value };\n            });\n        }\n        const sessionInfo = this.app.session.getInfo();\n        const userInfo = this.app.session.userInfo;\n        const requestObject = {\n            projectID: sessionInfo.projectID,\n            userID: sessionInfo.userID,\n            metadata: sessionInfo.metadata,\n            referrer: document.referrer,\n            os: userInfo.userOS,\n            device: userInfo.userDevice,\n            country: userInfo.userCountry,\n            state: userInfo.userState,\n            city: userInfo.userCity,\n            browser: userInfo.userBrowser,\n            persistFlags: persistFlags,\n        };\n        const authToken = token !== null && token !== void 0 ? token : this.app.session.getSessionToken();\n        const resp = await fetch(this.app.options.ingestPoint + '/v1/web/feature-flags', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                Authorization: `Bearer ${authToken}`,\n            },\n            body: JSON.stringify(requestObject),\n        });\n        if (resp.status === 200) {\n            const data = await resp.json();\n            return this.handleFlags(data.flags);\n        }\n    }\n    handleFlags(flags) {\n        var _a;\n        const persistFlags = [];\n        flags.forEach((flag) => {\n            if (flag.is_persist)\n                persistFlags.push(flag);\n        });\n        let str = '';\n        const uniquePersistFlags = this.diffPersist(persistFlags);\n        uniquePersistFlags.forEach((flag) => {\n            str += `${JSON.stringify(flag)};`;\n        });\n        this.app.sessionStorage.setItem(this.storageKey, str);\n        this.flags = flags;\n        return (_a = this.onFlagsCb) === null || _a === void 0 ? void 0 : _a.call(this, flags);\n    }\n    clearPersistFlags() {\n        this.app.sessionStorage.removeItem(this.storageKey);\n    }\n    diffPersist(flags) {\n        const persistFlags = this.app.sessionStorage.getItem(this.storageKey);\n        if (!persistFlags)\n            return flags;\n        const persistFlagsStrArr = persistFlags.split(';').filter(Boolean);\n        const persistFlagsArr = persistFlagsStrArr.map((flag) => JSON.parse(flag));\n        return flags.filter((flag) => persistFlagsArr.findIndex((pf) => pf.key === flag.key) === -1);\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}