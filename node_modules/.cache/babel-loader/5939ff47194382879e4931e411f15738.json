{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst utils_js_1 = require(\"../utils.js\");\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nfunction resolveURL(url, location = document.location) {\n  url = url.trim();\n  if (url.startsWith('//') || url.startsWith('http://') || url.startsWith('https://') || url.startsWith('data:') // any other possible value here? https://bugzilla.mozilla.org/show_bug.cgi?id=1758035\n  ) {\n    return url;\n  } else if (url.startsWith('/')) {\n    return location.origin + url;\n  } else {\n    return location.origin + location.pathname + url;\n  }\n}\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1607081\nfunction isSVGInFireFox(url) {\n  return utils_js_1.IS_FIREFOX && (url.startsWith('data:image/svg+xml') || url.match(/.svg$|/i));\n}\nconst PLACEHOLDER_SRC = 'https://static.openreplay.com/tracker/placeholder.jpeg';\nfunction default_1(app) {\n  function sendPlaceholder(id, node) {\n    app.attributeSender.sendSetAttribute(id, 'src', PLACEHOLDER_SRC);\n    const {\n      width,\n      height\n    } = node.getBoundingClientRect();\n    if (!node.hasAttribute('width')) {\n      app.attributeSender.sendSetAttribute(id, 'width', String(width));\n    }\n    if (!node.hasAttribute('height')) {\n      app.attributeSender.sendSetAttribute(id, 'height', String(height));\n    }\n  }\n  const sendSrcset = function (id, img) {\n    const {\n      srcset\n    } = img;\n    if (!srcset) {\n      return;\n    }\n    const resolvedSrcset = srcset.split(',').map(str => resolveURL(str)).join(',');\n    app.attributeSender.sendSetAttribute(id, 'srcset', resolvedSrcset);\n  };\n  const sendSrc = function (id, img) {\n    if (img.src.length > utils_js_1.MAX_STR_LEN) {\n      sendPlaceholder(id, img);\n    }\n    app.send((0, messages_gen_js_1.SetNodeAttributeURLBased)(id, 'src', img.src, app.getBaseHref()));\n  };\n  const sendImgError = app.safe(function (img) {\n    const resolvedSrc = resolveURL(img.src || ''); // Src type is null sometimes. - is it true?\n    if ((0, utils_js_1.isURL)(resolvedSrc)) {\n      app.send((0, messages_gen_js_1.ResourceTiming)(app.timestamp(), 0, 0, 0, 0, 0, resolvedSrc, 'img', 0, false));\n    }\n  });\n  const sendImgAttrs = app.safe(function (img) {\n    const id = app.nodes.getID(img);\n    if (id === undefined) {\n      return;\n    }\n    if (!img.complete) {\n      return;\n    }\n    if (img.naturalHeight === 0 && img.naturalWidth === 0 && !isSVGInFireFox(img.src)) {\n      sendImgError(img);\n    } else if (app.sanitizer.isHidden(id) || app.sanitizer.isObscured(id)) {\n      sendPlaceholder(id, img);\n    } else {\n      sendSrc(id, img);\n      sendSrcset(id, img);\n    }\n  });\n  const observer = (0, utils_js_1.createMutationObserver)(app.safe(mutations => {\n    for (const mutation of mutations) {\n      if (mutation.type === 'attributes') {\n        const target = mutation.target;\n        const id = app.nodes.getID(target);\n        if (id === undefined) {\n          return;\n        }\n        if (mutation.attributeName === 'src') {\n          sendSrc(id, target);\n        }\n        if (mutation.attributeName === 'srcset') {\n          sendSrcset(id, target);\n        }\n      }\n    }\n  }));\n  app.attachStopCallback(() => {\n    observer.disconnect();\n  });\n  app.nodes.attachNodeCallback(node => {\n    if (!(0, guards_js_1.hasTag)(node, 'img')) {\n      return;\n    }\n    app.nodes.attachNodeListener(node, 'error', () => sendImgError(node));\n    app.nodes.attachNodeListener(node, 'load', () => sendImgAttrs(node));\n    sendImgAttrs(node);\n    observer.observe(node, {\n      attributes: true,\n      attributeFilter: ['src', 'srcset']\n    });\n  });\n}\nexports.default = default_1;","map":{"version":3,"names":["Object","defineProperty","exports","value","utils_js_1","require","messages_gen_js_1","guards_js_1","resolveURL","url","location","document","trim","startsWith","origin","pathname","isSVGInFireFox","IS_FIREFOX","match","PLACEHOLDER_SRC","default_1","app","sendPlaceholder","id","node","attributeSender","sendSetAttribute","width","height","getBoundingClientRect","hasAttribute","String","sendSrcset","img","srcset","resolvedSrcset","split","map","str","join","sendSrc","src","length","MAX_STR_LEN","send","SetNodeAttributeURLBased","getBaseHref","sendImgError","safe","resolvedSrc","isURL","ResourceTiming","timestamp","sendImgAttrs","nodes","getID","undefined","complete","naturalHeight","naturalWidth","sanitizer","isHidden","isObscured","observer","createMutationObserver","mutations","mutation","type","target","attributeName","attachStopCallback","disconnect","attachNodeCallback","hasTag","attachNodeListener","observe","attributes","attributeFilter","default"],"sources":["/Users/paramvirrotwal/Observability/website-admin-react-web-app-project/node_modules/@openreplay/tracker/cjs/modules/img.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_js_1 = require(\"../utils.js\");\nconst messages_gen_js_1 = require(\"../app/messages.gen.js\");\nconst guards_js_1 = require(\"../app/guards.js\");\nfunction resolveURL(url, location = document.location) {\n    url = url.trim();\n    if (url.startsWith('//') ||\n        url.startsWith('http://') ||\n        url.startsWith('https://') ||\n        url.startsWith('data:') // any other possible value here? https://bugzilla.mozilla.org/show_bug.cgi?id=1758035\n    ) {\n        return url;\n    }\n    else if (url.startsWith('/')) {\n        return location.origin + url;\n    }\n    else {\n        return location.origin + location.pathname + url;\n    }\n}\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1607081\nfunction isSVGInFireFox(url) {\n    return utils_js_1.IS_FIREFOX && (url.startsWith('data:image/svg+xml') || url.match(/.svg$|/i));\n}\nconst PLACEHOLDER_SRC = 'https://static.openreplay.com/tracker/placeholder.jpeg';\nfunction default_1(app) {\n    function sendPlaceholder(id, node) {\n        app.attributeSender.sendSetAttribute(id, 'src', PLACEHOLDER_SRC);\n        const { width, height } = node.getBoundingClientRect();\n        if (!node.hasAttribute('width')) {\n            app.attributeSender.sendSetAttribute(id, 'width', String(width));\n        }\n        if (!node.hasAttribute('height')) {\n            app.attributeSender.sendSetAttribute(id, 'height', String(height));\n        }\n    }\n    const sendSrcset = function (id, img) {\n        const { srcset } = img;\n        if (!srcset) {\n            return;\n        }\n        const resolvedSrcset = srcset\n            .split(',')\n            .map((str) => resolveURL(str))\n            .join(',');\n        app.attributeSender.sendSetAttribute(id, 'srcset', resolvedSrcset);\n    };\n    const sendSrc = function (id, img) {\n        if (img.src.length > utils_js_1.MAX_STR_LEN) {\n            sendPlaceholder(id, img);\n        }\n        app.send((0, messages_gen_js_1.SetNodeAttributeURLBased)(id, 'src', img.src, app.getBaseHref()));\n    };\n    const sendImgError = app.safe(function (img) {\n        const resolvedSrc = resolveURL(img.src || ''); // Src type is null sometimes. - is it true?\n        if ((0, utils_js_1.isURL)(resolvedSrc)) {\n            app.send((0, messages_gen_js_1.ResourceTiming)(app.timestamp(), 0, 0, 0, 0, 0, resolvedSrc, 'img', 0, false));\n        }\n    });\n    const sendImgAttrs = app.safe(function (img) {\n        const id = app.nodes.getID(img);\n        if (id === undefined) {\n            return;\n        }\n        if (!img.complete) {\n            return;\n        }\n        if (img.naturalHeight === 0 && img.naturalWidth === 0 && !isSVGInFireFox(img.src)) {\n            sendImgError(img);\n        }\n        else if (app.sanitizer.isHidden(id) || app.sanitizer.isObscured(id)) {\n            sendPlaceholder(id, img);\n        }\n        else {\n            sendSrc(id, img);\n            sendSrcset(id, img);\n        }\n    });\n    const observer = (0, utils_js_1.createMutationObserver)(app.safe((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type === 'attributes') {\n                const target = mutation.target;\n                const id = app.nodes.getID(target);\n                if (id === undefined) {\n                    return;\n                }\n                if (mutation.attributeName === 'src') {\n                    sendSrc(id, target);\n                }\n                if (mutation.attributeName === 'srcset') {\n                    sendSrcset(id, target);\n                }\n            }\n        }\n    }));\n    app.attachStopCallback(() => {\n        observer.disconnect();\n    });\n    app.nodes.attachNodeCallback((node) => {\n        if (!(0, guards_js_1.hasTag)(node, 'img')) {\n            return;\n        }\n        app.nodes.attachNodeListener(node, 'error', () => sendImgError(node));\n        app.nodes.attachNodeListener(node, 'load', () => sendImgAttrs(node));\n        sendImgAttrs(node);\n        observer.observe(node, { attributes: true, attributeFilter: ['src', 'srcset'] });\n    });\n}\nexports.default = default_1;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}